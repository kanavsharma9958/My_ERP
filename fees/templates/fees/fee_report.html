<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fee Collection Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container my-5">
        <div class="card shadow-sm">
            <div class="card-body p-4">
                <h1 class="card-title text-center mb-4">Fee Collection Report</h1>

                <form method="get" class="row g-3 align-items-center mb-4 p-3 bg-white rounded border">
                    <div class="col-md-5">
                        <label for="start_date" class="form-label">Start Date</label>
                        <input type="date" name="start_date" id="start_date" class="form-control" value="{{ start_date|default:'' }}">
                    </div>
                    <div class="col-md-5">
                        <label for="end_date" class="form-label">End Date</label>
                        <input type="date" name="end_date" id="end_date" class="form-control" value="{{ end_date|default:'' }}">
                    </div>
                    <div class="col-md-2 d-grid">
                        <label class="form-label">&nbsp;</label>
                        <button type="submit" class="btn btn-primary">Generate Report</button>
                    </div>
                </form>

                {% if start_date and end_date %}
                    <div class="alert alert-info">
                        Showing report from <strong>{{ start_date }}</strong> to <strong>{{ end_date }}</strong>
                    </div>
                    
                    <div class="card text-center text-bg-success mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Total Collection</h5>
                            <p class="card-text fs-2 fw-bold">₹ {{ total_collection|floatformat:2 }}</p>
                        </div>
                    </div>

                    <h4 class="mt-5">Detailed Transactions</h4>
                    <table class="table table-striped table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Payment ID</th>
                                <th>Date</th>
                                <th>Student Name</th>
                                <th>Roll Number</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for payment in payments %}
                                <tr>
                                    <td>{{ payment.id }}</td>
                                    <td>{{ payment.payment_date|date:"d M, Y" }}</td>
                                    <td>{{ payment.invoice.student.full_name }}</td>
                                    <td>{{ payment.invoice.student.roll_number }}</td>
                                    <td>₹ {{ payment.amount|floatformat:2 }}</td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="5" class="text-center">No payments found in this date range.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="alert alert-secondary">
                        Please select a start and end date to generate a report.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>